---
title: Try Hack Me - Advent of Cyber 4 (2022)
date: 2022-12-01 00:28:00 -500
categories: [ctf,try hack me]
tags: [writeup,walkthrough,frameworks,log analysis,OSINT,scanning,brute-forcing]
---

After waiting for a full year, it's finally back! [Try Hack Me](https://tryhackme.com) is hosting their famous [Advent of Cyber](https://tryhackme.com/room/adventofcyber4) for the 4th time. It consists of a series of beginner challenges, which you can complete every day from the first of December until Christmas. I thought it would be cool to give it a go, so I'll try to update everyday (or as soon as I can) for the different challenges I complete.

They have a cool story following the whole duration of the challenges, which explains that we need to solve the challenges in order to save Christmas. I will not follow the story so much, so hope you just enjoy the challenges.

**Table of Contents**

- [Day 1 - Someone's coming to town! (Frameworks)](#day-1---someones-coming-to-town-frameworks)
- [Day 2 - Santa's Naughty and Nice Log (Log Analysis)](#day-2---santas-naughty-and-nice-log-log-analysis)
- [Day 3 - Nothing escapes detective McRed  (OSINT)](#day-3---nothing-escapes-detective-mcred--osint)
- [Day 4 - Scanning through the snow (Scanning)](#day-4---scanning-through-the-snow-scanning)
- [Day 5 - He knows when you're awake (Brute-Forcing)](#day-5---he-knows-when-youre-awake-brute-forcing)
- [Next days incoming ...](#next-days-incoming-)

# Day 1 - Someone's coming to town! (Frameworks)

When we press on the *View Site* green button, we can see a website in which we have to solve 3 puzzles. Those are not too difficult, but they teach us about the different phases of the **Unified Kill Chain**. The puzzles look as follow: 

**Puzzle 1**

1. Research is part of my task, finding clues in public sources.
2. Simple documents I turn into malware.
3. A pizza, parcel or payload all have me as an action in common.
4. A con is the name of my game, tricking you into believing a false identity.
5. Weaknesses are my go-to resources; through them, I make my presence felt.
6. I am set up to let you back into the network after you leave.
7. Deletion of evidence is part of my process.
8. Communication with the compromised goes through me.

![puzzle 1](/images/adventofcyber_puzzle1.png)

**Puzzle 2**

1. I am an anchor that lets you go on an adventure and explore.
2. With me, you can locate new information to expand the attack.
3. Once a pawn, I became a King.
4. My payloads are triggered to infect all they come in contact with.
5. Passwords I collect are the keys to the mainframe.
6. Side to side, machine to machine, we hop.

![puzzle 2](/images/adventofcyber_puzzle2.png)

**Puzzle 3**

1. In your vault, I am in.
2. Like a dragon, I gather all valuable loot.
3. I export gathered treasures.
4. With me, your reputation goes tumbling down.
5. Goals set, goals attained. I win!

![puzzle 3](/images/adventofcyber_puzzle3.png)

After completing the 3 puzzles, we see a final page in which we get the info to answer the two questions of the challenge: 

**Who is the adversary that attacked Santa's network this year?**
`The Bandit Yeti`

**What's the flag that they left behind?**
`THM{IT'S A Y3T1 CHR1$TMA$}`

# Day 2 - Santa's Naughty and Nice Log (Log Analysis)

For today's challenge we are going to be taking a look at log files. For that, we start the machine and connect to it via `ssh`:

`ssh elfmcblue@IP_ADDRESS`

Introduce the password when prompted, and we can start answering the questions: 

**Use the ls command to list the files present in the current directory. How many log files are present?**

~~~
elfmcblue@day-2-log-analysis:~$ ls
SSHD.log  webserver.log
~~~

So the answer is `2` (`SSHD.log` and `webserver.log`).

**Elf McSkidy managed to capture the logs generated by the web server. What is the name of this log file?** Looks like it's the one called `webserver.log` (what a surprise).

**On what day was Santa's naughty and nice list stolen?**
We don't know how the list is called exactly, but let's assume it has either the word "naughty" or "nice".

~~~
elfmcblue@day-2-log-analysis:~$ grep naughty webserver.log 
10.10.249.191 - - [18/Nov/2022:12:35:18 +0000] "GET /naughty-james HTTP/1.1" 404 437 "-" "gobuster/3.0.1"
~~~

BINGO!

So the date is 18th of November of 2022. I tried a few ways of writing this down on the platform and nothing was working. Finally I looked for which day of the week 18th of November of 2022 was, and then the platform accepted it!

So the answer is `friday`.

**What is the IP address of the attacker?**
In the same line of the log retrieved for the previous question, we can see that the IP address used was `10.10.249.191`, so that's the answer.

**What is the name of the important list that the attacker stole from Santa?**
Since we know that the list has the structure `**********.***` (so, 10 characters, a dot, and 3 more characters), we can try to use the `grep -E` flag to use regex. The expression used is `[A-Za-z0-9]{10}\.[A-Za-z0-9]{3}`

~~~
elfmcblue@day-2-log-analysis:~$ grep -E "[A-Za-z0-9]{10}\.[A-Za-z0-9]{3}" webserver.log 
10.9.12.30 - - [18/Nov/2022:12:18:23 +0000] "GET /assets/css/stylesheet.e534de95c45f12e712642d4891fdc622837d0270dd58b129282e0e4b65b5df1a.css HTTP/1.1" 200 4526 "http://10.10.60.160/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/107.0.0.0 Safari/537.36"
10.10.249.191 - - [18/Nov/2022:12:34:39 +0000] "GET /santaslist.txt HTTP/1.1" 200 133872 "-" "Wget/1.19.4 (linux-gnu)"
~~~

Not sure if my regex is nice and elegant, since I'm not good at it, but it worked, so we find that the list is `santaslist.txt`

**Look through the log files for the flag. The format of the flag is: THM{}**
Since we know part of the structure of the flag, it will be easy to get it with another grep. 
First we try the `webserver.log` file:

~~~
elfmcblue@day-2-log-analysis:~$ grep THM webserver.log 
10.10.249.191 - - [18/Nov/2022:12:35:20 +0000] "GET /AU7VTHM1YVYV8 HTTP/1.1" 404 437 "-" "gobuster/3.0.1"
~~~

mmmm so there is a line which contains "THM", but that's not the flag. Let's try it on the other log file (`SSHD.log`)
~~~
elfmcblue@day-2-log-analysis:~$ grep "THM" SSHD.log
THM{STOLENSANTASLIST}
~~~

There it is! Second day solved

# Day 3 - Nothing escapes detective McRed  (OSINT)

Today's challenge is focused on OSINT, which is the data and information that is collected from publicly available sources. As always, we get a bit of information on the topic, which is really nicely explained and contains everything we need to solve the questions. So let's get to it:

**What is the name of the Registrar for the domain santagift.shop?**
Let's look for the domain's information in the [who.is](https://who.is/whois) website. We enter the domain `santagift.shop`, and the first thing on the information table we see is the *Registrar Info*, where we can see that the name is `NAMECHEAP INC`.

**Find the website's source code (repository) on github.com and open the file containing sensitive credentials. Can you find the flag?**
If we go to [GitHub](https://github.com), and search for `Santagiftshop` or `santagift.shop`, we will see the repository from muhammadthm: 

![github repo](/images/adventofcyber_day3_1.png)


Looking around a bit, we see that the flag is at the beginning  of the file `config.php`. So the answer is `THM_OSINT_WORKS`.

**What is the name of the file containing passwords?**
As said in the previous question, the file is `config.php`.

**What is the name of the QA server associated with the website?**
On the main page of the repository on GitHub, we can see that the `README` is already giving us the answer: 

![github QA domain](/images/adventofcyber_day3_2.png)

So the answer is `qa.santagift.shop`.

**What is the DB_PASSWORD that is being reused between the QA and PROD environments?**
On the same `config.php` file we saw before, if we look for `DB_PASSWORD`, we see that the two occurrences have the same value (`S@nta2022`), and they are used `if($ENV = "QA")`, and `if($ENV = "PROD")`. Which means that the QA and PROD environments share the same value of `DB_PASSWORD`. The answer is then `S@nta2022`.

See you tomorrow!

# Day 4 - Scanning through the snow (Scanning)

Today we will be scanning a host for open ports, and use the information from yesterday's challenge in order to see how the `santagift.shop` website was compromised.  

First of all, let's see which ports are open and what are the services running on those.

~~~
└─$ nmap -sV <IP_ADDRESS>     
Starting Nmap 7.91 ( https://nmap.org ) at 2022-12-04 17:52 CET
Nmap scan report for <IP_ADDRESS>
Host is up (0.041s latency).
Not shown: 996 closed ports
PORT    STATE SERVICE     VERSION
22/tcp  open  ssh         OpenSSH 7.6p1 Ubuntu 4ubuntu0.5 (Ubuntu Linux; protocol 2.0)
80/tcp  open  http        Apache httpd 2.4.29 ((Ubuntu))
139/tcp open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)
445/tcp open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)
Service Info: Host: IP-<IP_ADDRESS>; OS: Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 13.12 seconds
~~~

With that, we can already answer the firsts questions:

**What is the name of the HTTP server running on the remote host?** : `Apache`.

**What is the name of the service running on port 22 on the QA server?** `ssh`.

For the last two questions we will need to connect to the Samba service. Since I haven't used it much, I thought I would do it through `cli` (opposite to the way they show on the platform), and learn a bit for future challenges. We are given: 

* Username : `ubuntu` 
* password : `S@nta2022`
* ip address : may vary. I'll show it as `<IP_ADDRESS>`

First, to see which shares are available on this host, let's run `smbclient -U ubuntu -L <IP_ADDRESS>`, and enter the password when prompted: 

~~~
└─$ smbclient -U ubuntu -L <IP_ADDRESS> 
Enter WORKGROUP\ubuntu's password: 

        Sharename       Type      Comment
        ---------       ----      -------
        print$          Disk      Printer Drivers
        sambashare      Disk      Samba on Ubuntu
        admins          Disk      Samba on Ubuntu
        IPC$            IPC       IPC Service (ip-<IP_ADDRESS> server (Samba, Ubuntu))
SMB1 disabled -- no workgroup available
~~~

The share `admins` looks juicy, so let's access this one. The service would be called `\\<IP_ADDRESS>\admins`, yet due to shell restrictions we need to escape the backslashes, and we end up with: 

~~~
└─$ smbclient -U ubuntu \\\\<IP_ADDRESS>\\admins S@nta2022
Try "help" to get a list of possible commands.
smb: \> ls
  .                                   D        0  Thu Nov 10 06:44:30 2022
  ..                                  D        0  Wed Nov  9 18:43:21 2022
  flag.txt                            A       23  Wed Nov  9 18:55:58 2022
  userlist.txt                        A      111  Thu Nov 10 06:44:29 2022
~~~

Looks like we got it! Now we will use `smbget` to download the files from the share. 

~~~
└─$ smbget smb://<IP_ADDRESS>/admins/flag.txt -U "ubuntu%S@nta2022"
Using workgroup WORKGROUP, user ubuntu
smb://<IP_ADDRESS>/admins/flag.txt                                                                                  
Downloaded 23b in 0 seconds

└─$ cat flag.txt                         
{THM_SANTA_SMB_SERVER}

└─$ smbget smb://<IP_ADDRESS>/admins/userlist.txt -U "ubuntu%S@nta2022"
Using workgroup WORKGROUP, user ubuntu
smb://<IP_ADDRESS>/admins/userlist.txt                                                                              
Downloaded 111b in 0 seconds

└─$ cat userlist.txt 
USERNAME        PASSWORD
santa           santa101
santahr         santa25
santaciso       santa30
santatech       santa200
santaaccounts   santa400
~~~

**What flag can you find after successfully accessing the Samba service?** As we can see in the output of the `cat flag.txt` command, the flag is `{THM_SANTA_SMB_SERVER}`.

**What is the password for the username santahr?** As we can see in the output of the `cat unserlist.txt` command, the password is `santa25`.

# Day 5 - He knows when you're awake (Brute-Forcing)

Welcome to Day 5 of Advent of Cyber.  Today we'll be discovering a password via brute-forcing, and using it to connect to the VNC server.  Let's see what they ask us to do:

**Use Hydra to find the VNC password of the target with IP address `<IP_ADDRESS>`. What is the password?**

We will the use the tool *Hydra* for that. The command we want to use has the following syntax: 

`hydra -l username -P wordlist.txt server service`
* username : they didn't give us a specific username, so let's try it without one.
* wordlist.txt : On kali linux there are already pre-made wordlists. We'll be using `/usr/share/wordlists/rockyou.txt`
* server : that's the IP address given when starting the machine. In my case it's `10.10.170.133`
* service : which service we want to launch the attack to (`ssh`, `rdp`, `ftp`, `vnc`, etc). In this case they are asking us for `vnc`

So we run `hydra -P /usr/share/wordlists/rockyou.txt 10.10.170.130 vnc`

![puzzle 3](/images/adventofcyber_day5_hydra.png)

After a while, it finds a valid pair, which means that there was no user, and the password is `1q2w3e4r`. 

**Using a VNC client on the AttackBox, connect to the target of IP address MACHINE_IP. What is the flag written on the target’s screen?**

To solve this, I decided to use `vncviewer`. The syntax is `vncviewer host::port`. We are missing the port, so we can just run the following nmap command: 

```
└─$ nmap -sV 10.10.170.133  
Starting Nmap 7.92 ( [https://nmap.org](https://nmap.org/) ) at 2022-12-05 12:36 EST  
Nmap scan report for 10.10.170.133  
Host is up (0.034s latency).  
Not shown: 998 closed tcp ports (conn-refused)  
PORT     STATE SERVICE VERSION  
22/tcp   open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.5 (Ubuntu Linux; protocol 2.0)  
5900/tcp open  vnc     VNC (protocol 3.8)  
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel  
  
Service detection performed. Please report any incorrect results at [https://nmap.org/submit/](https://nmap.org/submit/) .  
Nmap done: 1 IP address (1 host up) scanned in 1.57 seconds
```

We find then that the port is `5900`, and we can now connect to the target via vnc. 

```
└─$ vncviewer 10.10.170.133::5900  
Connected to RFB server, using protocol version 3.8  
Performing standard VNC authentication  
Password:  
Authentication successful  
```
And automatically, the remote target's window pops up:
![puzzle 3](/images/adventofcyber_day5_vnc.png)
We can see on the background of the screen that the flag is `THM{I_SEE_YOUR_SCREEN}`.

# Next days incoming ...